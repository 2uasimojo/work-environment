#!/bin/bash
#
# Prints the name of the Hive cluster that provisioned a v4 cluster.
#

set -euo pipefail

OCM_CLUSTERID=${1:-$OCM_CLUSTERID}
if [[ -z "$OCM_CLUSTERID" ]]
then
  echo "Usage: $0 <ocm-clusterid>" > /dev/stderr
  exit 1
fi

ocm get /api/clusters_mgmt/v1/clusters/$OCM_CLUSTERID/provision_shard | \
  jq --raw-output ".hive_config.server" | \
  gawk '{ if (match($0, /^https:\/\/api\.([-a-z0-9]+)\./, groups)) print groups[1] }'
